总体架构：Clean & SOLID启发的四层架构
本框架采用一个内核精炼、功能分层、依赖清晰的架构，其核心设计思想是 “稳定内核，可拔插增强”。整个架构围绕一个纯粹的核心引擎展开，通过标准的接口与各种“增强器”连接，以实现编译期分析、运行时监控等高级功能，而所有决策权最终都交还给开发者。

graph TD
    subgraph A [核心引擎层 Core Engine]
        A1[DSL & 流程定义]
        A2[类型安全的流程执行器]
        A3[统一的执行模型]
    end

    subgraph B [静态增强层 (可选)]
        B1[注解处理器]
        B2[KSP 静态分析器]
        B3[生成：洞察报告/流图文档]
    end

    subgraph C [运行时增强层 (可选)]
        C1[拦截器接口]
        C2[指标收集插件]
        C3[追踪与诊断插件]
    end

    subgraph D [外围集成层]
        D1[Ktor/Spring Boot 适配器]
        D2[Web 仪表盘]
        D3[IDE 插件]
    end

    B -- “基于” --> A
    C -- “注入” --> A
    D -- “使用或暴露” --> A & B & C
    
    style A fill:#e1f5e1
    style B fill:#e3f2fd
    style C fill:#fff3e0
    style D fill:#fce4ec

第1层：核心引擎层 - 职责：流程定义与执行
这是框架的唯一强制依赖，必须保持极简、稳定、无副作用。

声明式DSL：

提供类似 apexFlow { ... } 的构建器，让开发者以 transform、filter、branch 等操作声明业务流图。

核心是定义 Flow<T> 到 Flow<R> 的转换链。

统一执行模型：

同一个流程定义，应能通过不同终端执行：

.execute(input): Result (单次)

.asFlow(sourceFlow): Flow<Result> (流式)

.executeAll(list): List<Result> (批量)

类型安全构建器：

利用Kotlin泛型，在编译时确保相邻 transform 的输入/输出类型匹配。这是框架提供的最基础的“编译期安全”。

第2层：静态增强层 - 职责：编译期分析与洞察
这是实现“深度洞察”的第一把利器，完全在编译期工作。

注解驱动的元数据：

提供 @FlowNode(name=“”, category=CPU/IO) 等注解，让开发者标记关键节点。

KSP静态分析器：

分析被注解的代码，构建完整的流程有向图模型，包含节点、边、数据类型。

执行静态规则检查（如资源生命周期闭环、潜在的死锁模式）。

生成“洞察报告”：

不生成业务代码，而是输出结构化报告（JSON/HTML），内容包括：

可视化流图。

类型流转清单。

静态优化建议（例如：“节点A和B是纯函数，可合并”）。

潜在风险警告。

第3层：运行时增强层 - 职责：运行时监控与诊断
这是实现“深度洞察”的第二把利器，在运行时透明地收集数据。

拦截器接口：

提供标准的 FlowInterceptor 接口，允许插件在流程执行的各个生命周期（onStart, onEach, onCompletion, onError）注入逻辑。

可观测性插件：

指标插件：自动测量每个节点的耗时、吞吐量、错误率，并暴露给 Micrometer 等系统。

追踪插件：为流经的数据项分配唯一追踪ID，实现跨节点的请求链路追踪。

动态诊断与建议：

基于实时指标，在仪表盘中高亮显示瓶颈节点。

结合静态流图，给出动态建议（如：“该节点平均处理耗时100ms，是上游生产速度的3倍，建议检查其内部逻辑或增加其并行度”）。

第4层：外围集成层 - 职责：易用性与呈现
让框架能力更好地交付给开发者。

Web框架适配器：

提供与 Ktor、Spring WebFlux 的集成模块，简化将 HTTP 请求/响应映射到流程的方法。

可视化仪表盘：

一个独立的Web应用，融合静态流图和实时指标，提供交互式的系统洞察视图。

IDE插件（远期）：

在IDE中直接显示流程视图和实时洞察。

核心设计原则（SOLID体现）
单一职责：每层、每个插件只做一件事。核心引擎只编排，KSP只分析，插件只监控。

开闭原则：核心引擎对修改关闭。所有新功能（新分析规则、新监控维度）通过实现插件接口来扩展。

接口隔离：插件接口细粒度划分（如 MetricsInterceptor、TracingInterceptor），让插件按需实现。

依赖倒置：

高层模块（如仪表盘）不依赖低层细节（如具体的指标库），而是依赖抽象的 InsightRepository 接口。

核心引擎绝对不依赖任何增强层。增强层依赖核心引擎的接口。